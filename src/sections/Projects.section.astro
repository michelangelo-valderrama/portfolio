---
import ProjectsDesktop from "./ProjectsDesktop.section.astro"
import ProjectsMobile from "./ProjectsMobile.section.astro"
---

<div
  id="projects-section"
  class="text-foreground transition-all duration-500 ease-in-out"
>
  <ProjectsDesktop />
  <ProjectsMobile />
</div>

<script>
  import { scroll, animate } from "motion"

  const section = document.getElementById("projects-section")!
  const projects = document.querySelectorAll<HTMLDivElement>(
    "[project-item-color]"
  )
  const projectsLen = document.querySelectorAll<HTMLDivElement>(
    "[project-item-scroll]"
  )!.length

  scroll(
    animate("[project-item-scroll]", {
      transform: ["translateX(10%)", `translateX(-${projectsLen - 1}10%)`],
    }),
    {
      container: document.getElementById("content")!,
      target: document.getElementById("projects-section-desktop")!,
    }
  )

  projects.forEach((s) => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            section.style.setProperty("--foreground", `${s.dataset.color}`)
            section.style.setProperty("--border", `${s.dataset.color}`)
            document.body.style.setProperty(
              "--frame-color",
              `${s.dataset.color}`
            )
            document.body.style.setProperty(
              "--header-foreground",
              `${s.dataset.color}`
            )
          }
        })
      },
      {
        threshold: 0.5,
      }
    )
    observer.observe(s)
  })
</script>
